'Copyright (c) 2007-2011 Bo Morgan.
 All rights reserved.
 
 Author: Bo Morgan
 
 Permission to use, copy, modify and distribute this software and its
 documentation is hereby granted, provided that both the copyright
 notice and this permission notice appear in all copies of the
 software, derivative works or modified versions, and any portions
 thereof, and that both notices appear in supporting documentation.
 
 BO MORGAN ALLOWS FREE USE OF THIS SOFTWARE IN ITS "AS IS" CONDITION.
 BO MORGAN DISCLAIMS ANY LIABILITY OF ANY KIND FOR ANY DAMAGES
 WHATSOEVER RESULTING FROM THE USE OF THIS SOFTWARE.
 
 Bo Morgan requests users of this software to return to bo@mit.edu any
 improvements or extensions that they make and grant Bo Morgan the
 rights to redistribute these changes.'

[defunk em_two_about-content [context]
  [string-prog '<h1>About</h1>'
	       ''
	       'Coming soon!']]

[defunk em_two_about [context]
  [em_two_page context
	       [em_two_about-content context]]]


[defunk em_two_news-content [context]
  [string-prog [stringlist-prog [let [[index 0]]
				  [mapcar [funk [post]
						[= index [+ index 1]]
						[string-prog '<div class="post">'
							     [stringlist-concat `['<h1 class="title"><a name=post' ,[exp-as-string index] '>' ,[get post title] '</a></h1>']]
							     [stringlist-concat `['<p class="byline"><small>Posted on ' ,[get post date] ' by ' ,[get post author] '</small></p>']]
							     '  <div class="entry">'
							     [get post entry]
							     '	<p class="links"><a href="#" class="more">Read More</a> &nbsp;&nbsp;&nbsp; <a href="#" class="comments">No Comments</a></p>'
							     '  </div>'
							     '</div>']]
					  [get context posts]]]]
	       ]]

[defunk em_two_news [context]
  [em_two_page context
	       [em_two_news-content context]]]


[defunk em_two_documentation_format [documentation]
  [string-prog '<table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;</td><td>'
	       [if [is-type `string documentation]
		   [stringlist-intersperse [have documentation split '\n'] '<br>']
		 [exp-as-string documentation]]
	       '</td></tr></table>']]

[defunk em_two_funk_documentation [funk]
  [em_two_documentation_format [get funk documentation]]]

[defunk em_two_object_documentation [context type_name]
  [print [string-concat 'compiling ' [get type_name as-string] ' object documentation']]
  [em_two_page posts examples
	      [string-prog [string-concat '<h1><tt>' [get type_name as-string] '</tt> Object Documentation</h1>']
			   [let [[type [lookup_type type_name]]]
			     [string-prog '<h2><tt>get</tt> interface</h2>'
					  '<ul>'
					  [stringlist-prog [mapcar [funk [key_name]
									 [print [string-concat '  key: ' [get key_name as-string]]]
									 [let [[funk [get type type_var_value `get key_name nil]]]
									   [string-prog [string-concat '<li><tt>' [get key_name as-string] ' ' [exp-as-string [get funk args]] '</tt><br>']
											'<p>'
											[em_two_funk_documentation funk]
											'</p><br>'
											'</li>']]]
								   [get type type_var-keys `get]]]
					  '</ul>'
					  ''
					  '<h2><tt>set</tt> interface</h2>'
					  '<ul>'
					  [stringlist-prog [mapcar [funk [key_name]
									 [print [string-concat '  key: ' [get key_name as-string]]]
									 [let [[funk [get type type_var_value `set key_name nil]]]
									   [string-prog [string-concat '<li><tt>' [get key_name as-string] ' ' [exp-as-string [get funk args]] '</tt><br>']
											'<p>'
											[em_two_funk_documentation funk]
											'</p><br>'
											'</li>']]]
								   [get type type_var-keys `set]]]
					  '</ul>'
					  ''
					  '<h2><tt>execute</tt> interface</h2>'
					  '<ul>'
					  [stringlist-prog [mapcar [funk [key_name]
									 [print [string-concat '  key: ' [get key_name as-string]]]
									 [let [[funk [get type type_var_value `execute key_name nil]]]
									   [string-prog [string-concat '<li><tt>' [get key_name as-string] ' ' [exp-as-string [get funk args]] '</tt><br>']
											'<p>'
											[em_two_funk_documentation funk]
											'</p><br>'
											'</li>']]]
								   [get type type_var-keys `execute]]]
					  '</ul>'
					  ]]
			   ''
			   ]]]

[defunk em_two_documentation-all_objects-save [root_dir posts examples]
  [mapc [funk [type_name]
	      [let [[type_name_string     [get type_name as-string]]
		    [object_documentation [em_two_object_documentation posts examples type_name]]]
		[shelter [mkdir [string-concat root_dir 'documentation/object/' type_name_string]]]
		[have object_documentation save [string-concat root_dir 'documentation/object/' type_name_string '/index.html']]]]
	[system-type_names]]]

[defunk em_two_package_documentation [posts examples package_name]
  [print [string-concat 'compiling ' [get package_name as-string] ' package documentation']]
  [em_two_page posts examples
	      [string-prog [string-concat '<h1><tt>' [get package_name as-string] '</tt> Package Documentation</h1>']
			   [let [[package [lookup-package package_name]]]
			     [string-prog '<h2>Package Dependencies</h2>'
					  '<ul>'
					  [stringlist-prog [mapcar [funk [package_dependency]
									 [print [string-concat '  package dependency: ' [get package_dependency as-string]]]
									 [string-prog [string-concat '<li><a href=../' [get package_dependency as-string] '><tt>' [get package_dependency as-string] '</tt></a></li>']]]
								   [get package package_dependencies]]]
					  '</ul>'
					  ''
					  '<h2>Documentation</h2>'
					  '<p>'
					  [em_two_documentation_format [get package documentation]]
					  '</p><br>'
					  ''
					  '<h2>Objects Defined</h2>'
					  '<ul>'
					  [stringlist-prog [mapcar [funk [object_type_defined]
									 [print [string-concat '  object type defined: ' [get object_type_defined as-string]]]
									 [string-prog [string-concat '<li><a href=../../object/' [get object_type_defined as-string] '><tt>' [get object_type_defined as-string] '</tt></a></li>']]]
								   [get [get package object_types_defined_set] elements]]]
					  '</ul>'
					  ]]]]]

[defunk em_two_documentation-all_packages []
  `[movie
    isis_visual_object
    deliberative_execution_agency
    builtin_reactive_neural_plug_agency
    forgetful_event_stream
    semantic_resource_action_event
    isis_world_demo
    isismon_knowledge
    semantic_object_type
    semantic_temporal_object
    isis_world_client
    traced_resource
    mental_layer
    self_conscious_layer
    moral_compass_perception
    semantic_causal_object
    semantic_knowledge_base
    graph_isomorphism
    semantic_action_event
    image_sequence
    meta_semantic_knowledge_base
    deliberative_layer
    conceptnet
    mind
    self_conscious_imprimer_agency
    image
    agent_body
    graph_match_error_correcting
    divisi2
    isismon_learned_reactive_physical_activator
    semantic_ordered_object
    graph_cluster 
    learned_reactive_physical_knowledge_agency
    semantic_resource
    semantic_resource_action_sequence
    graph_match
    learned_reactive_language_agency
    learned_reactive_physical_agency
    isismon
    semantic_event_sequence
    self_reflective_layer
    moral_agent_body
    moral_compass
    timeline
    moral_compass_visual_agent
    moral_compass_visual_object
    reflective_credit_assignment_agency
    semantic_packable_object
    self_reflective_meta_mental_knowledge_agency
    isis_visual_agent
    event_stream
    isismon_agent
    isismon_core
    mindmon
    semantic_physical_object
    traced_mind
    moral_compass_proprioceptual_object
    agency
    builtin_reactive_physical_agency
    semantic_event
    semantic_agent
    semantic_frame
    semantic_object
    semantic_realm
    reflective_layer
    deliberative_meta_physical_knowledge_agency
    semantic_containment_object 
    semantic_relationship_key
    builtin_reactive_sensory_agency
    semantic_visual_object
    resource
    semantic_directed_action_event
    semantic_causal_event
    self_reflective_other_agents_knowledge_agency
    learned_reactive_layer 
    isismon_builtin_reactive_physical_activator
    learned_reactive_sensory_agency
    builtin_reactive_layer
    physical_world
    propogator]]

[defunk em_two_documentation-all_packages-require []
  [mapc [funk [package_name]
	      [if [not [get [lookup-package package_name] loaded_all_dependencies_time]]
		  [prog [print [format nil 'requiring ' package_name '.']]
			[require-package package_name]]]]
	[em_two_documentation-all_packages]]]

[defunk em_two_documentation-all_packages-save [root_dir posts examples]
  [shelter [mkdir [string-concat root_dir 'documentation/package']]]
  [mapc [funk [package_name]
	      [let [[package_name_string   [get package_name as-string]]
		    [package_documentation [em_two_package_documentation posts examples package_name]]]
		[shelter [mkdir [string-concat root_dir 'documentation/package/' package_name_string]]]
		[have package_documentation save [string-concat root_dir 'documentation/package/' package_name_string '/index.html']]]]
	[em_two_documentation-all_packages]]]

[defunk em_two_documentation-content [root_dir posts examples]
  [shelter [mkdir [string-concat root_dir 'documentation']]]
  [shelter [mkdir [string-concat root_dir 'documentation/object']]]
  [string-prog '<h1>Documentation</h1>'
	       ''
	       '<h2>Packages</h2>'
	       ''
	       '<ul>'
	       [stringlist-prog [mapcar [funk [package_name_string]
					      [string-concat '<li><a href="/documentation/package/' package_name_string '"><strong>' package_name_string '</strong></a></li>']]
					[have [mapcar [funk [package_name]
							    [get package_name as-string]]
						      [em_two_documentation-all_packages]]
					      sort &>]]]
	       '</ul>'
	       '<h2>All Object Types</h2>'
	       ''
	       '<ul>'
	       [stringlist-prog [mapcar [funk [type_name_string]
					      [string-concat '<li><a href="/documentation/object/' type_name_string '"><strong>' type_name_string '</strong></a></li>']]
					[have [mapcar [funk [type_name]
							    [get type_name as-string]]
						      [system-type_names]]
					      sort &>]]]
	       '</ul>'
	       '']]

[defunk em_two_documentation [root_dir posts examples]
  [em_two_page posts examples
	      [em_two_documentation-content root_dir posts examples]]]


[defunk em_two_download-content []
  [string-prog '<h1>Download</h1>'
	       ''
	       'Coming soon!']]

[defunk em_two_download [posts examples]
  [em_two_page posts examples
	      [em_two_download-content]]]


[defunk em_two_tutorial-content []
  [string-prog '<h1>Tutorial</h1>'
	       ''
	       'Coming soon!']]

[defunk em_two_tutorial [posts examples]
  [em_two_page posts examples
	      [em_two_tutorial-content]]]


[defunk em_two_example [posts examples example]
  [let [[content [string-prog '<!-- start content -->'
			      '<div id="content">'
			      '  <div class="post">'
			      [stringlist-concat `['<h1 class="title">' ,[get example title] '</h1>']]
			      [stringlist-concat `['<p class="byline"><small>Posted on ' ,[get example date] ' by ' ,[get example author] '</small></p>']]
			      '    <div class="entry">'
			      '      <p>'
			      [em_two_code_section [get example entry]]
			      '      </p>'
			      [string-concat '<p class="links"><a href="/example/' [get example name] '.fu2" class="more">Download</a> &nbsp;&nbsp;&nbsp; <a href="#" class="comments">No Comments</a></p>']
			      '    </div>'
			      '  </div>'
			      '</div>'
			      '<!-- end content -->']]]
    [em_two_page posts examples content]]]

[defunk compile_em_two_example [root_dir posts examples example]
  [let [[example_html_code [em_two_example posts examples example]]]
    [shelter [mkdir [string-concat root_dir 'example']]]
    [shelter [mkdir [string-concat root_dir 'example/' [get example name]]]]
    [have [string-prog [string-concat '\'' [get example title] '\'']
		       [string-concat '\'This example Em_two code was downloaded from http://www.em-two.net/example/' [get example name] '.fu2\'']
		       ''
		       [get example entry]]
	  save [string-concat root_dir 'example/' [get example name] '.fu2']]
    [have example_html_code   save [string-concat root_dir 'example/' [get example name] '/index.html']]
    nil]]

[defunk compile_em_two_examples [root_dir posts examples]
  [mapc [funk [example]
	      [print [string-concat 'compiling example ' [get example name]]]
	      [compile_em_two_example root_dir posts examples example]]
	examples]
  nil]

[defunk em_two-generate_all_posts []
  `[,[let [[this [new em_two_post]]]
       [set this title  'Welcome to the official Moral Compass Website!']
       [set this date   'March 13th, 2011']
       [set this author '<a href="#">Bo Morgan</a>']
       [set this entry  [string-prog '<p><strong>Moral Compass</strong> is a free, open, cognitive architecture designed for social commonsense reasoning algorithms.  '
				     'This project is developed by the <a href=http://rct.media.mit.edu/rct>Reflective Commonsense Thinking</a> group at the <a href=http://www.media.mit.edu>MIT Media Lab</a>.'
				     'Moral Compass is primarily meant as a cognitive science research tool for testing hypothesis for social reasoning, including cooperative and non-cooperative behavior.']]
       this]
    ]]

[defunk em_two-generate_all_examples []
  `[]]

[defunk compile_em_two_images [root_dir]
  [shelter [mkdir [string-concat root_dir 'images/']]]
  [system [string-concat 'cp -f example/em_two_webpage/images/favicon.ico ' root_dir]]
  [let [[image_names `['img01.jpg'
		       'img02.jpg'
		       'em_two_logo_header.jpg'
		       'media_lab_logo_header.jpg']]]
    [mapc [funk [image_name]
		[system [string-concat 'cp -f example/em_two_webpage/images/' image_name ' ' root_dir 'images/']]]
	  image_names]]
  nil]


[defunk compile_em_two_webpage [context]
  [print 'compiling em_two css']           [compile_em_two_css           context]
  [print 'compiling em_two root page']     [compile_em_two_root_page     context]
  [print 'compiling em_two tabs']          [have context compile_tabs]
  [print 'compiling em_two documentation'] [compile_em_two_documentation context]
  [print 'compiling em_two examples']      [compile_em_two_examples      context]
  [print 'done compiling']
  nil]]

[let [[context [new htmldoc_context '/home/neptune/Desktop/www/em-two/']]]
  [set  context title                                  'Moral Compass -- Cognitive Architecture for Social Commonsense']
  [set  context posts                                  [generate_all_posts]]
  [set  context examples                               [generate_all_examples]]
  [set  context background_color                       '#000000']
  [set  context font_color                             '#FFFFFF']
  [set  context link_color                             '#7193AF']
  [set  context logo_primary_font_color                '#FFFFFF']
  [set  context logo_secondary_font_color              '#0F0E11']
  [set  context logo_link_font_color                   '#FFFFFF']
  [set  context menu_link_right_border_color           '#000000']
  [set  context menu_link_color                        '#FFFFFF']
  [set  context page_background_color                  '#000000']
  [set  context latest_post_border_color               '#E7E7E7']
  [set  context content_title_link_color               '#FFFFFF']
  [set  context content_title_link_bottom_border_color '#000000']
  [set  context content_byline_bottom_border_color     '#000000']
  [set  context content_links_background_color         '#000000']
  [set  context sidebar_list_divider_color             '#253542']
  [set  context sidebar_background_color               '#000000']
  [set  context sidebar_font_color                     '#7193AF']
  [set  context sidebar_link_color                     '#FFFFFF']
  [set  context footer_top_border_color                '#253542']
  [set  context footer_font_color                      '#FFFFFF']
  [set  context footer_link_color                      '#FFFFFF']
  [set  context search_background_color                '#000000']
  [set  context search_border_color                    '#111111']
  [set  context search_active_border_color             '#111111']
  [set  context search_font_color                      '#CCCCCC']
  [set  context search_link_color                      '#FFFFFF']
  [set  context search_visited_link_color              '#FFFFFF']
  [set  context search_hover_link_color                '#FFFFFF']
  [set  context search_active_link_color               '#FFFFFF']
  [set  context search_url_color                       '#AAAAAA']
  [have context add_tab          [new htmldoc_tab `About         &em_two_about]]
  [have context add_tab          [new htmldoc_tab `News          &em_two_news]]
  [have context add_tab          [new htmldoc_tab `Documentation &em_two_documentation]]
  [have context add_tab          [new htmldoc_tab `Tutorial      &em_two_tutorial]]
  
  [defunk webpage-save         []                                                    [compile_em_two_webpage  context]]
  [defunk em_two_css-save      []                                                    [compile_em_two_css      context]]
  [defunk em_two_about-save    [] [have [get context tab `About]    compile context]]
  [defunk em_two_news-save     [] [have [get context tab `News]     compile context]]
  [defunk em_two_tutorial-save [] [have [get context tab `Tutorial] compile context] [compile_em_two_tutorial context]]
  [defunk em_two_examples-save []                                                    [compile_em_two_examples context]]
  
  ]

